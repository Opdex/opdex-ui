<opdex-card [hasToolbar]="true" style="position: relative;" [noPadding]="true">
  <ng-container toolbar>
    <div class="details">
      <h4 class="title d-inline">Recent Transactions</h4>
    </div>
  </ng-container>

  <div #feedContainer
    class="feed-container"
    [ngClass]="{'large': size === 'l', 'medium': size === 'm', 'small': size === 's'}"
    style="position: relative;"
    infiniteScroll
    [infiniteScrollDistance]="1"
    [infiniteScrollThrottle]="50"
    [scrollWindow]="false"
    (scrolled)="onScroll()">
    <ng-container *ngIf="!loading; else loader">
      <ng-container *ngIf="transactions?.length > 0; else noTransactions" >
        <div class="transaction" *ngFor="let tx of transactions; trackBy: transactionsTrackBy; let i = index">
          <div class="tx-container">
            <div class="d-flex flex-row align-items-center w-100 mb-1">
              <div class="icon-container">
                <opdex-copy-button
                  [tooltip]="tx.hash"
                  [value]="tx.hash"
                  [icon]="tx.transactionType?.icon || icons.error"
                  [size]="iconSizes.small"
                  [color]="tx.transactionType?.iconColor || 'error'"></opdex-copy-button>
              </div>

              <div class="w-100 d-flex light justify-content-between">
                <small>{{tx?.transactionSummary}}</small>
                <small>{{tx?.block?.medianTime | timeago}}</small>
              </div>
            </div>

            <div class="w-100 icon-container-offset" *ngIf="tx.transactionType; else invalid">
              <ng-container [ngSwitch]="tx.transactionType.title">
                <opdex-swap-transaction-summary [transaction]="tx" *ngSwitchCase="'Swap'"></opdex-swap-transaction-summary>
                <opdex-provide-transaction-summary [transaction]="tx" *ngSwitchCase="'Provide'"></opdex-provide-transaction-summary>
                <opdex-mine-transaction-summary [transaction]="tx" *ngSwitchCase="'Mine'"></opdex-mine-transaction-summary>
                <opdex-stake-transaction-summary [transaction]="tx" *ngSwitchCase="'Stake'"></opdex-stake-transaction-summary>
                <opdex-enable-mining-transaction-summary [transaction]="tx" *ngSwitchCase="'Enable Mining'"></opdex-enable-mining-transaction-summary>
                <opdex-create-pool-transaction-summary [transaction]="tx" *ngSwitchCase="'Create Pool'"></opdex-create-pool-transaction-summary>
                <opdex-distribute-transaction-summary [transaction]="tx" *ngSwitchCase="'Distribute'"></opdex-distribute-transaction-summary>
                <opdex-allowance-transaction-summary [transaction]="tx" *ngSwitchCase="'Allowance'"></opdex-allowance-transaction-summary>
              </ng-container>
            </div>

            <ng-template #invalid>
              <div class="icon-container-offset d-flex flex-row align-items-center">
                Unable to read transaction summary.
              </div>
            </ng-template>
          </div>

          <mat-divider *ngIf="i < transactions.length - 1" style="position: relative;"></mat-divider>
        </div>

        <div class="d-flex flex-row align-items-center justify-content-center mt-3 mb-3" *ngIf="!endReached && nextPage">
          <mat-spinner class="tiny mr-2"></mat-spinner> Coming right up...
        </div>
      </ng-container>
      <ng-template #noTransactions>
        <div class="mt-2 mb-2">
          No transactions found.
        </div>
      </ng-template>
    </ng-container>

    <ng-template #loader>
      <div class="d-flex h-100 flex-column align-items-center justify-content-center">
        <mat-spinner class="small mb-3"></mat-spinner>
        <p>Magic happening...</p>
      </div>
    </ng-template>
  </div>

  <div class="refresh-container" [ngClass]="{'refreshAvailable': refreshAvailable}" >
    <button mat-flat-button color="primary" (click)="refresh()">Refresh <mat-icon class="tiny">{{icons.refresh}}</mat-icon></button>
  </div>
</opdex-card>
