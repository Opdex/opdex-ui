<div class="pool-details">
  <div class="pool-selection" *ngIf="!pool">
    <opdex-card>
      <form [formGroup]="poolForm" name="liquidity-pool-form" id="liquidity-pool-form">
        <mat-form-field floatLabel="always">
          <mat-label>Liquidity Pool</mat-label>

          <button mat-icon-button matPrefix type="button" class="mr-2" disabled><mat-icon>{{icons.liquidityPool}}</mat-icon></button>

          <input matInput aria-label="Public Key" [matAutocomplete]="auto" [formControl]="poolControl" type="text">

          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selectPool($event)">
            <ng-container *ngIf="pools$ | async">
              <mat-option *ngFor="let pool of filteredPools$ | async" [value]="pool">
                <div class="flex-column">
                  <small class="overflow-ellipsis" style="font-size: 15px; line-height: 20px">{{pool.name}}</small>
                  <small class="overflow-ellipsis light" style="font-size: 12px; line-height: 16px;">{{pool.address}}</small>
                </div>
              </mat-option>
            </ng-container>

          </mat-autocomplete>
        </mat-form-field>
      </form>
    </opdex-card>
  </div>

  <opdex-card class="pool-summary" *ngIf="pool">
    <h4 class="mb-0">
      <opdex-copy-button [tooltip]="pool?.address" [value]="pool?.address" [icon]="icons.link" [size]="iconSizes.small"></opdex-copy-button>
      <a class="blue ml-1" routerLink="/pools/{{pool?.address}}">{{pool.name}}</a>
    </h4>

    <button mat-icon-button [ngClass]="iconSizes.tiny" class="exit" (click)="clearPool()">
      <mat-icon>{{icons.close}}</mat-icon>
    </button>

    <ng-container *ngIf="showReserves">
      <div class="pool-details-section">
        <div class="col flex-shrink flex-column justify-content-end">
          <button type="button" mat-icon-button color="primary" [ngClass]="iconSizes.tiny" class="d-block" (click)="srcToggle.toggle()">
            <mat-icon #srcToggle="matTooltip" matTooltip="Reserves">{{icons.tokens}}</mat-icon>
          </button>

          <button type="button" mat-icon-button color="primary" [ngClass]="iconSizes.tiny" class="d-block" (click)="crsToggle.toggle()">
            <mat-icon #crsToggle="matTooltip" matTooltip="Reserves">{{icons.tokens}}</mat-icon>
          </button>

          <button type="button" mat-icon-button color="primary" [ngClass]="iconSizes.tiny" class="d-block" (click)="lpToggle.toggle()">
            <mat-icon class="provide" #lpToggle="matTooltip" matTooltip="Liquidity Pool Token Supply">{{icons.provide}}</mat-icon>
          </button>
        </div>

        <div class="col">
          <small class="light no-wrap">Token</small>
          <small>{{pool.token.crs.symbol}}</small>
          <small>{{pool.token.src.symbol}}</small>
          <small>{{pool.token.lp.symbol}}</small>
        </div>

        <div class="col">
          <small class="light no-wrap">Reserves</small>
          <small>{{pool.summary.reserves.crs | shortNumber}}</small>
          <small>{{pool.summary.reserves.src | shortNumber}}</small>
          <small>{{pool.token.lp.totalSupply | shortNumber}}</small>
        </div>

        <div class="col flex-row-end">
          <div class="flex-column-end">
            <small class="light no-wrap">(24hr)</small>
            <small><opdex-change-indicator [value]="pool.token.crs.summary.dailyPriceChangePercent" size="s" [forceDisplay]="true"></opdex-change-indicator></small>
            <small><opdex-change-indicator [value]="pool.token.src.summary.dailyPriceChangePercent" size="s" [forceDisplay]="true"></opdex-change-indicator></small>
            <small><opdex-change-indicator [value]="pool.token.lp.summary.dailyPriceChangePercent" size="s" [forceDisplay]="true"></opdex-change-indicator></small>
          </div>

          <div class="ml-2">
            <small class="light">Price</small>
            <small>${{pool.token.crs.summary.priceUsd | shortNumber}}</small>
            <small>${{pool.token.src.summary.priceUsd | shortNumber}}</small>
            <small>${{pool.token.lp.summary.priceUsd | shortNumber}}</small>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="pool.token?.staking && showStaking">
      <div class="pool-details-section" >
        <div class="col flex-shrink flex-column justify-content-end">
          <button type="button" mat-icon-button color="primary" [ngClass]="iconSizes.tiny" class="d-block" (click)="stakingToggle.toggle()">
            <mat-icon class="stake" #stakingToggle="matTooltip" matTooltip="Staking Weight">{{icons.staking}}</mat-icon>
          </button>
        </div>

        <div class="col">
          <small class="light no-wrap">Token</small>
          <small>{{pool.summary.staking?.token.symbol}}</small>
        </div>

        <div class="col">
          <small class="light no-wrap">Weight</small>
          <small>{{pool.summary.staking.weight | shortNumber}}</small>
        </div>

        <div class="col flex-row-end">
          <div class="flex-column-end">
            <small class="light no-wrap">(24hr)</small>
            <small><opdex-change-indicator [value]="pool.summary.staking?.token.summary.dailyPriceChangePercent" size="s" [forceDisplay]="true"></opdex-change-indicator></small>
          </div>

          <div class="ml-2">
            <small class="light">Price</small>
            <small>${{pool.summary.staking?.token.summary.priceUsd | shortNumber}}</small>
          </div>
        </div>
      </div>
    </ng-container>

    <ng-container *ngIf="pool.summary.miningPool?.tokensMining && showMining">
      <div class="pool-details-section">
        <div class="col flex-shrink flex-column justify-content-end">
          <button type="button" mat-icon-button color="primary" [ngClass]="iconSizes.tiny" class="d-block" (click)="miningToggle.toggle()">
            <mat-icon class="mine" #miningToggle="matTooltip" matTooltip="Mining">{{icons.mining}}</mat-icon>
          </button>
        </div>

        <div class="col">
          <small class="light no-wrap">Token</small>
          <small>{{pool.token.lp.symbol}}</small>
        </div>

        <div class="col">
          <small class="light no-wrap">Weight</small>
          <small>{{pool.summary.miningPool?.tokensMining | shortNumber}}</small>
        </div>

        <div class="col flex-row-end">
          <div class="flex-column-end">
            <small class="light no-wrap">(24hr)</small>
            <small><opdex-change-indicator [value]="pool.token.lp.summary.dailyPriceChangePercent" size="s" [forceDisplay]="true"></opdex-change-indicator></small>
          </div>

          <div class="ml-2">
            <small class="light">Price</small>
            <small>${{pool.token.lp.summary.priceUsd | shortNumber}}</small>
          </div>
        </div>
      </div>
    </ng-container>
  </opdex-card>
</div>
