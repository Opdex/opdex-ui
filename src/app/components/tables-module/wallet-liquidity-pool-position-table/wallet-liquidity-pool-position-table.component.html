<ng-container *ngIf="dataSource?.data?.length; else loading">
  <div class="table-container">
    <table mat-table [dataSource]="dataSource" matSort [trackBy]="trackBy" class="w-100">
      <ng-container matColumnDef="token" sticky>
        <th mat-header-cell *matHeaderCellDef> Token </th>
        <td mat-cell *matCellDef="let element" class="no-wrap">
          <div class="no-wrap d-flex align-items-center">
            <opdex-copy-button [tooltip]="element.token.address" [value]="element.token.address" [icon]="icons.link"></opdex-copy-button>
            <a class="no-decoration b-500" href="javascript:void(0)" (click)="navigate(element.token.address)">{{element.token.symbol}}</a>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="position">
        <th mat-header-cell *matHeaderCellDef> Position </th>
        <td mat-cell *matCellDef="let element"><span class="badge {{element.position | lowercase}}">{{element.position}}</span></td>
      </ng-container>

      <ng-container matColumnDef="amount">
        <th mat-header-cell *matHeaderCellDef> Amount </th>
        <td mat-cell *matCellDef="let element"><span class="no-wrap">{{element.amount.formattedValue | shortNumber}}</span></td>
      </ng-container>

      <ng-container matColumnDef="value">
        <th mat-header-cell *matHeaderCellDef> Value </th>
        <td mat-cell *matCellDef="let element">${{element.value.formattedValue | shortNumber}}</td>
      </ng-container>

      <ng-container matColumnDef="actions" stickyEnd>
        <th mat-header-cell *matHeaderCellDef>  </th>
        <td mat-cell *matCellDef="let element">
          <button mat-icon-button color="primary" [ngClass]="iconSizes.small" class="float-right" [matMenuTriggerFor]="beforeMenu">
            <mat-icon>{{icons.more}}</mat-icon>
          </button>

          <mat-menu #beforeMenu="matMenu" xPosition="before" class="w-100">
            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="swap()" *ngIf="element.position === 'Balance' && element.token.address !== pool.token?.staking?.address">
              <mat-icon class="swap">{{icons.swap}}</mat-icon> Swap {{element.token.symbol}}
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="provide('add')" *ngIf="element.position === 'Balance' && element.token.address !== pool.token?.staking?.address">
              <mat-icon class="provide">{{icons.provide}}</mat-icon> Provide {{element.token.symbol}}
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="provide('remove')" *ngIf="element.position === 'Providing'">
              <mat-icon class="provide">{{icons.remove}}</mat-icon> Remove Liquidity
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="stake('start')" *ngIf="element.position === 'Balance' && element.token.address === pool.token?.staking?.address">
              <mat-icon class="stake">{{icons.staking}}</mat-icon> Start Staking
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="stake('stop')" *ngIf="element.position === 'Staking'">
              <mat-icon class="stake">{{icons.remove}}</mat-icon> Stop Staking
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="stake('collect')" *ngIf="element.position === 'Staking'">
              <mat-icon class="stake">{{icons.collect}}</mat-icon> Collect Staking Rewards
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="mine('start')" *ngIf="element.position === 'Providing'">
              <mat-icon class="mine">{{icons.mining}}</mat-icon> Start Mining
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="mine('stop')" *ngIf="element.position === 'Mining'">
              <mat-icon class="mine">{{icons.remove}}</mat-icon> Stop Mining
            </button>

            <button mat-menu-item [ngClass]="iconSizes.small" class="d-flex align-items-center justify-content-start" (click)="mine('collect')" *ngIf="element.position === 'Mining'">
              <mat-icon class="mine">{{icons.collect}}</mat-icon> Collect Mining Rewards
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>
  </div>
</ng-container>

<ng-template #loading>
  No active positions found.
</ng-template>
