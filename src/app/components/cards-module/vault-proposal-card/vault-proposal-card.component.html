<opdex-card [fullHeight]="true">
  <ng-container *ngIf="proposal; else loading">
    <div class="flex-row-center-between flex-wrap">
      <a routerLink="/vault/proposal/{{proposal.proposalId}}" class="no-decoration">
        <h4 class="d-flex no-wrap mb-0">Proposal #{{proposal.proposalId}}</h4>
      </a>

      <span class="badge flex-row-center-center {{proposal.approved ? 'green' : 'red'}}" *ngIf="proposal.status === 'Complete' && proposal.expiration < latestBlock.height">
        <span>{{proposal.approved ? 'Approved' : 'Denied'}}</span>
        <mat-icon class="ml-1">{{proposal.approved ? icons.checkOutline : icons.closeOutline}}</mat-icon>
      </span>
    </div>

    <div class="flex-row-center mb-2">
      <small class="b-400 light">
        <span *ngIf="proposal.type === 'Create'">New Certificate</span>
        <span *ngIf="proposal.type === 'Revoke'">Revoke Certificate</span>
        <span *ngIf="proposal.type === 'TotalPledgeMinimum'">Change Pledge Minimum</span>
        <span *ngIf="proposal.type === 'TotalVoteMinimum'">Change Vote Minimum</span>
      </small>
    </div>

    <p class="mb-2" style="font-size: 1.4em; line-height: 1.2em" *ngIf="proposal.type !== 'Revoke'">
      <opdex-number [suffix]="proposal.type === 'Create' ? 'ODX' : 'CRS'" [value]="proposal.amount" [short]="true"></opdex-number>
    </p>

    <div class="space-between"></div>

    <div class="w-100 flex-row-center-between" style="flex-grow: 1">
      <div class="pledge flex-column">
        <small class="flex-row-center">
          <span class="light mr-1 b-400">Pledge</span>
          <mat-icon color="primary" [ngClass]="iconSizes.tiny" *ngIf="proposal.status === 'Pledge'">{{icons.inProgress}}</mat-icon>
          <mat-icon class="positive-value" [ngClass]="iconSizes.tiny" *ngIf="proposal.status === 'Vote'">{{icons.check}}</mat-icon>
        </small>

        <small class="flex-row-center">
          <button mat-flat-button class="mr-1 p-1 blue" style="min-width: 0" (click)="openSidenav('Pledge')" [ngClass]="iconSizes.tiny" [disabled]="!!this.context?.wallet === false">
            <mat-icon>{{icons.add}}</mat-icon>
          </button>

          <opdex-number [value]="proposal.pledgeAmount" [short]="true"></opdex-number>
        </small>
      </div>

      <div class="pledge flex-column">
        <small class="flex-row-center">
          <span class="light mr-1 b-400">Vote</span>
          <mat-icon color="primary" [ngClass]="iconSizes.tiny" *ngIf="proposal.status === 'Vote'">{{icons.inProgress}}</mat-icon>
        </small>

        <div class="flex-row-center-between">

          <small class="flex-row-center mr-3">
            <button mat-flat-button class="mr-1 p-1 green" style="min-width: 0" (click)="openSidenav('Vote', true)" [ngClass]="iconSizes.tiny" [disabled]="!!this.context?.wallet === false">
              <mat-icon>{{icons.thumbUp}}</mat-icon>
            </button>

            <opdex-number [value]="proposal.yesAmount" [short]="true"></opdex-number>
          </small>

          <small class="flex-row-center">
            <button mat-flat-button class="mr-1 p-1 red" style="min-width: 0" (click)="openSidenav('Vote', false)" [ngClass]="iconSizes.tiny" [disabled]="!!this.context?.wallet === false">
              <mat-icon>{{icons.thumbDown}}</mat-icon>
            </button>

            <opdex-number [value]="proposal.noAmount" [short]="true"></opdex-number>
          </small>
        </div>
      </div>
    </div>

    <ng-container *ngIf="proposal.expiration >= latestBlock.height && proposal.status !== 'Complete'">
      <mat-progress-bar [color]="proposal.expiration >= latestBlock.height ? 'primary' : 'warn'"
        class="mt-2 green"
        mode="determinate"
        [value]="getExpirationPercentage()">
      </mat-progress-bar>

      <small class="light">{{proposal.expiration - latestBlock.height | formatNumber:0}} blocks remaining</small>
    </ng-container>

    <button
      mat-stroked-button
      color="primary"
      class="mt-2 small w-100"
      *ngIf="proposal.status !== 'Complete' && proposal.expiration < latestBlock.height"
      (click)="completeProposal()"
      [disabled]="!!context?.wallet === false">
      Complete Proposal
    </button>
  </ng-container>

  <ng-template #loading>
    <div class="w-100">
      <div class="flex-row-center-between mb-1">
        <div class="skeleton-bg w-25"></div>
        <div class="skeleton-bg w-25"></div>
      </div>

      <div class="skeleton-bg w-25 mb-1"></div>

      <!-- extra big, no spacing intentionally -->
      <div class="mb-1">
        <div class="skeleton-bg w-50"></div>
        <div class="skeleton-bg w-50"></div>
      </div>

      <div class="flex-row-center-between mb-1">
        <div class="skeleton-bg w-25"></div>
        <div class="skeleton-bg w-25"></div>
        <div class="skeleton-bg w-25"></div>
      </div>

      <div class="skeleton-bg w-100"></div>
    </div>
  </ng-template>
</opdex-card>
